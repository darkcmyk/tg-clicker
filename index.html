<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TON –û–ø–ª–∞—Ç–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      padding: 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    select, button {
      font-size: 1rem;
      padding: 10px;
      border-radius: 10px;
      margin-top: 15px;
    }

    button {
      background-color: #0098ea;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:disabled {
      background-color: #888;
    }

    img {
      width: 220px;
      border-radius: 10px;
      margin: 20px auto;
    }

    .description {
      margin-top: 10px;
      font-size: 16px;
    }

    #wallet-address {
      margin-top: 10px;
      font-size: 14px;
    }

    .content {
      flex: 1;
      display: none;
      flex-direction: column;
      justify-content: center;
    }
  </style>
</head>
<body>

  <div id="connect-button"></div>

  <div id="wallet-address"></div>

  <div class="content" id="app-content">
    <select id="city-select">
      <option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
    </select>

    <img src="https://darkcmyk.github.io/tgclickers.github.io/product.jpg" alt="Product" />
    <div class="description"><strong>–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä, –í–ê–§–õ–Ø, 3 gram</strong></div>

    <button id="pay" disabled>üí∏ –û–ø–ª–∞—Ç–∏—Ç—å 0.5 TON</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const walletDiv = document.getElementById("wallet-address");
    const contentDiv = document.getElementById("app-content");
    const citySelect = document.getElementById("city-select");
    const payButton = document.getElementById("pay");

    const tonConnect = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: 'https://darkcmyk.github.io/tgclickers.github.io/tonconnect-manifest.json',
      buttonRootId: 'connect-button'
    });

    const cities = [
      "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–°–∞–º–∞—Ä–∞",
      "–û–º—Å–∫", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É", "–£—Ñ–∞", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–ü–µ—Ä–º—å", "–í–æ—Ä–æ–Ω–µ–∂", "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–¢—é–º–µ–Ω—å", "–°–∞—Ä–∞—Ç–æ–≤",
      "–¢–æ–ª—å—è—Ç—Ç–∏", "–ò–∂–µ–≤—Å–∫", "–ë–∞—Ä–Ω–∞—É–ª", "–£–ª—å—è–Ω–æ–≤—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫", "–•–∞–±–∞—Ä–æ–≤—Å–∫", "–Ø—Ä–æ—Å–ª–∞–≤–ª—å", "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", "–ú–∞—Ö–∞—á–∫–∞–ª–∞",
      "–¢–æ–º—Å–∫", "–û—Ä–µ–Ω–±—É—Ä–≥", "–ö–µ–º–µ—Ä–æ–≤–æ", "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫", "–†—è–∑–∞–Ω—å", "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å", "–ü–µ–Ω–∑–∞", "–õ–∏–ø–µ—Ü–∫", "–ö–∏—Ä–æ–≤", "–¢—É–ª–∞",
      "–ß–µ–±–æ–∫—Å–∞—Ä—ã", "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥", "–ë—Ä—è–Ω—Å–∫", "–ö—É—Ä—Å–∫", "–ò–≤–∞–Ω–æ–≤–æ", "–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫", "–¢–≤–µ—Ä—å", "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å", "–ë–µ–ª–≥–æ—Ä–æ–¥",
      "–°–æ—á–∏", "–ù–∏–∂–Ω–∏–π –¢–∞–≥–∏–ª", "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫", "–í–ª–∞–¥–∏–º–∏—Ä", "–°–º–æ–ª–µ–Ω—Å–∫", "–°—É—Ä–≥—É—Ç", "–ö–∞–ª—É–≥–∞", "–ß–∏—Ç–∞", "–Ø–∫—É—Ç—Å–∫", "–ì—Ä–æ–∑–Ω—ã–π",
      "–í–æ–ª–∂—Å–∫–∏–π", "–ß–µ—Ä–µ–ø–æ–≤–µ—Ü", "–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å", "–ù–∞–ª—å—á–∏–∫", "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫-–Ω–∞-–ê–º—É—Ä–µ", "–ö–æ—Å—Ç—Ä–æ–º–∞", "–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫", "–≠–ª–∏—Å—Ç–∞",
      "–ô–æ—à–∫–∞—Ä-–û–ª–∞", "–ü—Å–∫–æ–≤", "–ù–æ—Ä–∏–ª—å—Å–∫", "–ê–±–∞–∫–∞–Ω", "–û—Ä—ë–ª", "–í–µ–ª–∏–∫–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–°—ã–∫—Ç—ã–≤–∫–∞—Ä", "–ë–ª–∞–≥–æ–≤–µ—â–µ–Ω—Å–∫", "–£–ª–∞–Ω-–£–¥—ç"
    ];

    cities.forEach(city => {
      const option = document.createElement("option");
      option.value = city;
      option.textContent = city;
      citySelect.appendChild(option);
    });

    tonConnect.onStatusChange(wallet => {
      if (wallet) {
        walletDiv.innerText = "–ö–æ—à–µ–ª–µ–∫: " + wallet.account.address;
        contentDiv.style.display = "flex";
      } else {
        walletDiv.innerText = "‚õî –ü—Ä–∏–≤—è–∂–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫...";
        contentDiv.style.display = "none";
        tonConnect.connectWallet(); // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
      }
    });

    citySelect.onchange = () => {
      payButton.disabled = false;
    };

    payButton.onclick = async () => {
      const selectedCity = citySelect.value;
      if (!selectedCity || selectedCity === "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥") {
        tg.showAlert("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥");
        return;
      }

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 600,
        messages: [
          {
            address: "UQBfLcNf5TZZb6SEerk0Cr1V2AawL4glN0IG5DlO8mMyb7Uq",
            amount: (0.5 * 1e9).toString(),
          }
        ]
      };

      try {
        await tonConnect.sendTransaction(tx);
        tg.showAlert("‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –ì–æ—Ä–æ–¥: " + selectedCity);
      } catch (err) {
        tg.showAlert("‚ùå –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: " + err.message);
      }
    };
  </script>
</body>
</html>
