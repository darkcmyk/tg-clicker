<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ö–ª–∏–∫–µ—Ä RPG</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f7f7f7;
      padding: 20px;
      text-align: center;
    }
    h1 { margin-top: 10px; }
    #info, #upgrades, #result {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin: 10px auto;
      max-width: 400px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
    }
    .stat {
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>üí• Telegram –ö–ª–∏–∫–µ—Ä</h1>

<div id="info">
  <p>üë§ <span id="username">–ò–≥—Ä–æ–∫</span></p>
  <p>üÜî ID: <span id="userid">???</span></p>
  <p>üìà –£—Ä–æ–≤–µ–Ω—å: <span class="stat" id="level">1</span></p>
  <p>‚≠ê –û–ø—ã—Ç: <span class="stat" id="exp">0</span> / <span id="next_exp">10</span></p>
  <p>üí∞ –ú–æ–Ω–µ—Ç—ã: <span class="stat" id="coins">0</span></p>
  <p>üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞: <span class="stat" id="power">1</span></p>
</div>

<div id="upgrades">
  <button onclick="clickCoin()">+ –ö–ª–∏–∫!</button><br>
  <button onclick="upgrade()">–£–ª—É—á—à–∏—Ç—å —Å–∏–ª—É (üí∞ <span id="upgrade_cost">10</span>)</button>
</div>

<div id="result">
  <button onclick="sendToBot()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—Ç—É</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const state = {
    username: tg.initDataUnsafe.user?.first_name || "–ò–≥—Ä–æ–∫",
    userid: tg.initDataUnsafe.user?.id || "???",
    level: 1,
    exp: 0,
    coins: 0,
    power: 1
  };

  const nextLevelExp = () => state.level * 10;
  const upgradeCost = () => state.power * 10;

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
  function save() {
    localStorage.setItem("clicker_state", JSON.stringify(state));
  }

  function load() {
    const saved = localStorage.getItem("clicker_state");
    if (saved) {
      Object.assign(state, JSON.parse(saved));
    }
  }

  function updateUI() {
    document.getElementById("username").innerText = state.username;
    document.getElementById("userid").innerText = state.userid;
    document.getElementById("level").innerText = state.level;
    document.getElementById("exp").innerText = state.exp;
    document.getElementById("coins").innerText = state.coins;
    document.getElementById("power").innerText = state.power;
    document.getElementById("next_exp").innerText = nextLevelExp();
    document.getElementById("upgrade_cost").innerText = upgradeCost();
  }

  function clickCoin() {
    state.coins += state.power;
    state.exp += 1;
    if (state.exp >= nextLevelExp()) {
      state.exp = 0;
      state.level += 1;
    }
    save();
    updateUI();
  }

  function upgrade() {
    const cost = upgradeCost();
    if (state.coins >= cost) {
      state.coins -= cost;
      state.power += 1;
      save();
      updateUI();
    } else {
      alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
    }
  }

  function sendToBot() {
    const result = `–ü—Ä–æ—Ñ–∏–ª—å:\n–ò–º—è: ${state.username}\n–£—Ä–æ–≤–µ–Ω—å: ${state.level}\n–ú–æ–Ω–µ—Ç—ã: ${state.coins}\n–°–∏–ª–∞: ${state.power}`;
    tg.sendData(result);
  }

  load();
  updateUI();
</script>

</body>
</html>
